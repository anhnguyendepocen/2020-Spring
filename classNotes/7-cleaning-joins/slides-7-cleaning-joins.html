<!DOCTYPE html>
<html lang="" xml:lang="">
  <head>
    <title>Week 7: Data cleaning &amp; joins</title>
    <meta charset="utf-8" />
    <meta name="author" content="John Paul Helveston" />
    <meta name="date" content="2020-02-26" />
    <link href="libs/remark-css/default.css" rel="stylesheet" />
    <link href="libs/countdown/countdown.css" rel="stylesheet" />
    <script src="libs/countdown/countdown.js"></script>
    <link rel="stylesheet" href="https://emse-eda-gwu.github.io/2020-Spring/classNotes/classNotes.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">




name: xaringan-title
class: title-slide, center, middle, inverse

# Week 7: Data cleaning &amp; joins

.large[EMSE 4197 | John Paul Helveston | February 26, 2020]



---
class: middle, inverse, center

# Ask and you shall [receive](https://github.com/thomasp85/gganimate/issues/372)

---
class: inverse

# R tip of the week:

## Copy-paste magic with [`datapasta`](https://github.com/MilesMcBain/datapasta)

&lt;br&gt;

### **Useful for "small data"**: e.g., [U.S. State Abbreviations](https://www.50states.com/abbreviations.htm)

---
## Today's data

"Clean" data

```r
wildlife_impacts &lt;- read_csv(here::here('data', 'wildlife_impacts.csv'))
milk_production  &lt;- read_csv(here::here('data', 'milk_production.csv'))
msleep           &lt;- read_csv(here::here('data', 'msleep.csv'))
```

"Messy" data

```r
wind     &lt;- read_excel(here::here('data', 'US_State_Wind_Energy_Facts_2018.xlsx'))
hot_dogs &lt;- read_excel(here::here('data', 'hot_dog_winners.xlsx'))
pc_sales &lt;- read_excel(here::here('data', 'pc_sales_2018.xlsx'), skip = 5)
weather  &lt;- readRDS(here::here('data', 'weather.Rds'))
```

## Plus two new packages:

- **janitor**: for cleaning names
- **lubridate**: for manipulating dates

---
# One more note

`here()` != `here::here()`

---
# One more note

`here()` != `here::here()`

&lt;br&gt;

Syntax:

`library` + `::` + `function`

---
# One more note

.leftcol[
`here()` != `here::here()`

&lt;br&gt;

Syntax:

`library` + `::` + `function`

&lt;br&gt;
]
.rightcol[
Example:


```r
milk_production %&gt;%
    filter(year == 2000)
```


```r
milk_production %&gt;%
*   dplyr::filter(year == 2000)
```
]

---
class: inverse, middle

# Data cleaning &amp; joins

## 1. Joins
## 2. Re-typing variables
## 3. Re-naming variables
## 4. Re-coding variables
## 5. Data cleaning strategies

---
class: inverse, middle

# Data cleaning &amp; joins

## 1. .orange[Joins]
## 2. Re-typing variables
## 3. Re-naming variables
## 4. Re-coding variables
## 5. Data cleaning strategies



---
## Joins

1. `inner_join()`
2. `left_join()` / `right_join()`
3. `full_join()`


--
&amp;zwj;Example: `band_members` &amp; `band_instruments`

.leftcol[

```r
band_members
```

```
## # A tibble: 3 x 2
##   name  band   
##   &lt;chr&gt; &lt;chr&gt;  
## 1 Mick  Stones 
## 2 John  Beatles
## 3 Paul  Beatles
```
]
.rightcol[

```r
band_instruments
```

```
## # A tibble: 3 x 2
##   name  plays 
##   &lt;chr&gt; &lt;chr&gt; 
## 1 John  guitar
## 2 Paul  bass  
## 3 Keith guitar
```
]

---
.leftcol[
## `inner_join()`


```r
band_members %&gt;%
    inner_join(band_instruments)
```

```
## # A tibble: 2 x 3
##   name  band    plays 
##   &lt;chr&gt; &lt;chr&gt;   &lt;chr&gt; 
## 1 John  Beatles guitar
## 2 Paul  Beatles bass
```
]
.rightcol[
&lt;br&gt;
&lt;center&gt;
&lt;img src="images/inner_join.gif"&gt;
&lt;/center&gt;
]

---
.leftcol[
## `full_join()`


```r
band_members %&gt;%
    full_join(band_instruments)
```

```
## # A tibble: 4 x 3
##   name  band    plays 
##   &lt;chr&gt; &lt;chr&gt;   &lt;chr&gt; 
## 1 Mick  Stones  &lt;NA&gt;  
## 2 John  Beatles guitar
## 3 Paul  Beatles bass  
## 4 Keith &lt;NA&gt;    guitar
```
]
.rightcol[
&lt;br&gt;
&lt;center&gt;
&lt;img src="images/full_join.gif"&gt;
&lt;/center&gt;
]

---
.leftcol[
## `left_join()`


```r
band_members %&gt;%
    left_join(band_instruments)
```

```
## # A tibble: 3 x 3
##   name  band    plays 
##   &lt;chr&gt; &lt;chr&gt;   &lt;chr&gt; 
## 1 Mick  Stones  &lt;NA&gt;  
## 2 John  Beatles guitar
## 3 Paul  Beatles bass
```
]
.rightcol[
&lt;br&gt;
&lt;center&gt;
&lt;img src="images/left_join.gif"&gt;
&lt;/center&gt;
]

---
.leftcol[
## `right_join()`


```r
band_members %&gt;%
    right_join(band_instruments)
```

```
## # A tibble: 3 x 3
##   name  band    plays 
##   &lt;chr&gt; &lt;chr&gt;   &lt;chr&gt; 
## 1 John  Beatles guitar
## 2 Paul  Beatles bass  
## 3 Keith &lt;NA&gt;    guitar
```
]
.rightcol[
&lt;br&gt;
&lt;center&gt;
&lt;img src="images/right_join.gif"&gt;
&lt;/center&gt;
]

---
## Specify the joining variable name

.leftcol[

```r
band_members %&gt;%
    left_join(band_instruments)
```

```
## # A tibble: 3 x 3
##   name  band    plays 
##   &lt;chr&gt; &lt;chr&gt;   &lt;chr&gt; 
## 1 Mick  Stones  &lt;NA&gt;  
## 2 John  Beatles guitar
## 3 Paul  Beatles bass
```
]
.rightcol[

```r
band_members %&gt;%
    left_join(band_instruments,
*             by = 'name')
```

```
## # A tibble: 3 x 3
##   name  band    plays 
##   &lt;chr&gt; &lt;chr&gt;   &lt;chr&gt; 
## 1 Mick  Stones  &lt;NA&gt;  
## 2 John  Beatles guitar
## 3 Paul  Beatles bass
```
]

---
## Specify the joining variable name

If the names differ, use `by = c("left_name" = "joining_name")`

.leftcol[

```r
band_members
```

```
## # A tibble: 3 x 2
##   name  band   
##   &lt;chr&gt; &lt;chr&gt;  
## 1 Mick  Stones 
## 2 John  Beatles
## 3 Paul  Beatles
```

```r
band_instruments2
```

```
## # A tibble: 3 x 2
##   artist plays 
##   &lt;chr&gt;  &lt;chr&gt; 
## 1 John   guitar
## 2 Paul   bass  
## 3 Keith  guitar
```
]
--
.rightcol[

```r
band_members %&gt;%
    left_join(band_instruments2,
*             by = c("name" = "artist"))
```

```
## # A tibble: 3 x 3
##   name  band    plays 
##   &lt;chr&gt; &lt;chr&gt;   &lt;chr&gt; 
## 1 Mick  Stones  &lt;NA&gt;  
## 2 John  Beatles guitar
## 3 Paul  Beatles bass
```
]

---
class: inverse

.leftcol[.font90[
## Your turn
<div class="countdown blink-colon noupdate-15" id="timer_5e567e13" style="bottom:0;left:8;font-size:1.5em;" data-warnwhen="30">
<code class="countdown-time"><span class="countdown-digits minutes">15</span><span class="countdown-digits colon">:</span><span class="countdown-digits seconds">00</span></code>
</div>

1) Create a data frame called `state_data`:

a) Join the `states_abbs` data frame to the `milk_production` data frame.

b) Select the three variables `region`, `state_name`, `state_abb`.

.code70[


```r
head(state_data)
```

```
## # A tibble: 6 x 3
##   region    state_name    state_abb
##   &lt;chr&gt;     &lt;chr&gt;         &lt;chr&gt;    
## 1 Northeast Maine         ME       
## 2 Northeast New Hampshire NH       
## 3 Northeast Vermont       VT       
## 4 Northeast Massachusetts MA       
## 5 Northeast Rhode Island  RI       
## 6 Northeast Connecticut   CT
```
]]]
.rightcol[.font90[
2) Create the data frame `wildlife_impacts2` by joining the `state_data` data frame to the `wildlife_impacts` data frame, adding the variables `region` and `state_name`.


.code50[

```r
glimpse(wildlife_impacts2)
```

```
## Observations: 56,978
## Variables: 24
## $ incident_date         &lt;dttm&gt; 2018-12-31, 2018-12-29, 2018-12-29, 2018-12-27…
## $ state_abb             &lt;chr&gt; "FL", "IN", NA, NA, NA, "FL", "FL", NA, NA, "FL…
## $ airport_id            &lt;chr&gt; "KMIA", "KIND", "ZZZZ", "ZZZZ", "ZZZZ", "KMIA",…
## $ airport               &lt;chr&gt; "MIAMI INTL", "INDIANAPOLIS INTL ARPT", "UNKNOW…
## $ operator              &lt;chr&gt; "AMERICAN AIRLINES", "AMERICAN AIRLINES", "AMER…
## $ atype                 &lt;chr&gt; "B-737-800", "B-737-800", "UNKNOWN", "B-737-900…
## $ type_eng              &lt;chr&gt; "D", "D", NA, "D", "D", "D", "D", "D", "D", "D"…
## $ species_id            &lt;chr&gt; "UNKBL", "R", "R2004", "N5205", "J2139", "UNKB"…
## $ species               &lt;chr&gt; "Unknown bird - large", "Owls", "Short-eared ow…
## $ damage                &lt;chr&gt; "M?", "N", NA, "M?", "M?", "N", "N", "N", "N", …
## $ num_engs              &lt;dbl&gt; 2, 2, NA, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2…
## $ incident_month        &lt;dbl&gt; 12, 12, 12, 12, 12, 12, 12, 12, 12, 12, 12, 12,…
## $ incident_year         &lt;dbl&gt; 2018, 2018, 2018, 2018, 2018, 2018, 2018, 2018,…
## $ time_of_day           &lt;chr&gt; "Day", "Night", NA, NA, NA, "Day", "Night", NA,…
## $ time                  &lt;dbl&gt; 1207, 2355, NA, NA, NA, 955, 948, NA, NA, 1321,…
## $ height                &lt;dbl&gt; 700, 0, NA, NA, NA, NA, 600, NA, NA, 0, NA, 0, …
## $ speed                 &lt;dbl&gt; 200, NA, NA, NA, NA, NA, 145, NA, NA, 130, NA, …
## $ phase_of_flt          &lt;chr&gt; "departure", "arrival", "other", "other", "othe…
## $ sky                   &lt;chr&gt; "Some Cloud", NA, NA, NA, NA, NA, "Some Cloud",…
## $ precip                &lt;chr&gt; "None", NA, NA, NA, NA, NA, "None", NA, NA, "No…
## $ cost_repairs_infl_adj &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,…
## $ weekday_name          &lt;ord&gt; Mon, Sat, Sat, Thu, Thu, Thu, Thu, Wed, Sun, Su…
## $ region                &lt;chr&gt; "Southeast", "Corn Belt", NA, NA, NA, "Southeas…
## $ state_name            &lt;chr&gt; "Florida", "Indiana", NA, NA, NA, "Florida", "F…
```
]]]

---
class: inverse, middle

# Data cleaning &amp; joins

## 1. Joins
## 2. .orange[Re-typing variables]
## 3. Re-naming variables
## 4. Re-coding variables
## 5. Data cleaning strategies



---
## Using the `col_types` argument

- You can change the column type when reading in data
- Different syntax for [**readxl**](https://readxl.tidyverse.org/articles/cell-and-column-types.html) and [**readr**](https://readr.tidyverse.org/)

---
.leftcol40[
## **readxl**

`col_types` must be a vector describing each column type
]
.rightcol60[
&lt;br&gt;&lt;br&gt;

```r
wind &lt;- read_excel(
    here::here('data',
               'US_State_Wind_Energy_Facts_2018.xlsx'))

glimpse(wind)
```

```
## Observations: 50
## Variables: 7
## $ Ranking                         &lt;chr&gt; "1.0", "2.0", "3.0", "4.0", "5.0", "6…
## $ State                           &lt;chr&gt; "TEXAS", "OKLAHOMA", "IOWA", "CALIFOR…
## $ `Installed Capacity (MW)`       &lt;dbl&gt; 23262, 7495, 7312, 5686, 5110, 4464, …
## $ `Equivalent Homes Powered`      &lt;chr&gt; "6235000.0", "2268000.0", "1935000.0"…
## $ `Total Investment ($ Millions)` &lt;chr&gt; "42000.0", "13700.0", "14200.0", "126…
## $ `Wind Projects Online`          &lt;dbl&gt; 136, 45, 107, 104, 35, 49, 98, 31, 25…
## $ `# of Wind Turbines`            &lt;chr&gt; "12750.0", "3717.0", "4145.0", "6972.…
```
]

---
.leftcol40[
## **readxl**

`col_types` must be a vector describing each column type

&lt;br&gt;

.font80[
| How it is in Excel | How it will be in R | How to request in `col_types` |
|:--------------------|:-----------------------|:--------------------|
| *anything*          | *non-existent*         | `"skip"`            |
| empty               | `logical`, but all `NA` | *you cannot request this* |
| boolean            | `logical`               | `"logical"`         |
| numeric            | `numeric`               | `"numeric"`         |
| datetime           | `POSIXct`               | `"date"`            |
| text               | `character`             | `"text"`            |
| *anything*         | `list`                  | `"list"`            |
]]

.rightcol60[

```r
columns &lt;- c('numeric', 'text', rep('numeric', 5))
columns
```

```
## [1] "numeric" "text"    "numeric" "numeric" "numeric" "numeric" "numeric"
```

```r
wind &lt;- read_excel(
    here::here('data',
               'US_State_Wind_Energy_Facts_2018.xlsx'),
*   col_types = columns)

glimpse(wind)
```

```
## Observations: 50
## Variables: 7
## $ Ranking                         &lt;dbl&gt; 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12…
## $ State                           &lt;chr&gt; "TEXAS", "OKLAHOMA", "IOWA", "CALIFOR…
## $ `Installed Capacity (MW)`       &lt;dbl&gt; 23262, 7495, 7312, 5686, 5110, 4464, …
## $ `Equivalent Homes Powered`      &lt;dbl&gt; 6235000, 2268000, 1935000, 1298000, 1…
## $ `Total Investment ($ Millions)` &lt;dbl&gt; 42000, 13700, 14200, 12600, 9400, 890…
## $ `Wind Projects Online`          &lt;dbl&gt; 136, 45, 107, 104, 35, 49, 98, 31, 25…
## $ `# of Wind Turbines`            &lt;dbl&gt; 12750, 3717, 4145, 6972, 2795, 2632, …
```
]

---
## **readr**

`col_types` describes individual variables by name using `cols()`

.leftcol60[

```r
milk &lt;- read_csv(
    here::here('data', 'milk_production.csv'),
*   col_types = cols(year = col_character()))

glimpse(milk)
```

```
## Observations: 2,400
## Variables: 4
## $ region        &lt;chr&gt; "Northeast", "Northeast", "Northeast", "Northeast", "No…
## $ state         &lt;chr&gt; "Maine", "New Hampshire", "Vermont", "Massachusetts", "…
## $ year          &lt;chr&gt; "1970", "1970", "1970", "1970", "1970", "1970", "1970",…
## $ milk_produced &lt;dbl&gt; 6.1900e+08, 3.5600e+08, 1.9700e+09, 6.5800e+08, 7.5000e…
```
]

---
## **readr**

`col_types` describes individual variables by name using `cols()`

&lt;br&gt;

&lt;center&gt;
&lt;img src="images/readr_parse_functions.png" width=800&gt;
&lt;/center&gt;

---
class: inverse, middle

# Data cleaning &amp; joins

## 1. Joins
## 2. Re-typing variables
## 3. .orange[Re-naming variables]
## 4. Re-coding variables
## 5. Data cleaning strategies


&lt;!--
got the content on select() from Suzan Baert:
https://suzan.rbind.io/2018/01/dplyr-tutorial-1/
--&gt;

---
## Renaming made easy

.leftcol35[.noborder[.center[
`janitor::clean_names()`

&lt;center&gt;
&lt;img src="images/janitor_logo.png" width=200&gt;
&lt;/center&gt;
]]]
--
.rightcol65[

```r
wind &lt;- read_excel(
    here::here('data',
               'US_State_Wind_Energy_Facts_2018.xlsx'))

glimpse(wind)
```

```
## Observations: 50
## Variables: 7
## $ Ranking                         &lt;chr&gt; "1.0", "2.0", "3.0", "4.0", "5.0", "6…
## $ State                           &lt;chr&gt; "TEXAS", "OKLAHOMA", "IOWA", "CALIFOR…
## $ `Installed Capacity (MW)`       &lt;dbl&gt; 23262, 7495, 7312, 5686, 5110, 4464, …
## $ `Equivalent Homes Powered`      &lt;chr&gt; "6235000.0", "2268000.0", "1935000.0"…
## $ `Total Investment ($ Millions)` &lt;chr&gt; "42000.0", "13700.0", "14200.0", "126…
## $ `Wind Projects Online`          &lt;dbl&gt; 136, 45, 107, 104, 35, 49, 98, 31, 25…
## $ `# of Wind Turbines`            &lt;chr&gt; "12750.0", "3717.0", "4145.0", "6972.…
```
]

---
## Renaming made easy

.leftcol35[.noborder[.center[
`janitor::clean_names()`

&lt;center&gt;
&lt;img src="images/janitor_logo.png" width=200&gt;
&lt;/center&gt;

]]]
.rightcol65[

```r
wind &lt;- read_excel(
    here::here('data',
               'US_State_Wind_Energy_Facts_2018.xlsx')) %&gt;%
*   clean_names()

glimpse(wind)
```

```
## Observations: 50
## Variables: 7
## $ ranking                   &lt;chr&gt; "1.0", "2.0", "3.0", "4.0", "5.0", "6.0", "…
## $ state                     &lt;chr&gt; "TEXAS", "OKLAHOMA", "IOWA", "CALIFORNIA", …
## $ installed_capacity_mw     &lt;dbl&gt; 23262, 7495, 7312, 5686, 5110, 4464, 3699, …
## $ equivalent_homes_powered  &lt;chr&gt; "6235000.0", "2268000.0", "1935000.0", "129…
## $ total_investment_millions &lt;chr&gt; "42000.0", "13700.0", "14200.0", "12600.0",…
## $ wind_projects_online      &lt;dbl&gt; 136, 45, 107, 104, 35, 49, 98, 31, 25, 20, …
## $ number_of_wind_turbines   &lt;chr&gt; "12750.0", "3717.0", "4145.0", "6972.0", "2…
```
]

---
## Renaming made easy

.leftcol35[.noborder[.center[
`janitor::clean_names()`

&lt;center&gt;
&lt;img src="images/janitor_logo.png" width=200&gt;
&lt;/center&gt;

]]]
.rightcol65[

```r
wind &lt;- read_excel(
    here::here('data',
               'US_State_Wind_Energy_Facts_2018.xlsx')) %&gt;%
*   clean_names(case = 'lower_camel')

glimpse(wind)
```

```
## Observations: 50
## Variables: 7
## $ ranking                 &lt;chr&gt; "1.0", "2.0", "3.0", "4.0", "5.0", "6.0", "7.…
## $ state                   &lt;chr&gt; "TEXAS", "OKLAHOMA", "IOWA", "CALIFORNIA", "K…
## $ installedCapacityMw     &lt;dbl&gt; 23262, 7495, 7312, 5686, 5110, 4464, 3699, 32…
## $ equivalentHomesPowered  &lt;chr&gt; "6235000.0", "2268000.0", "1935000.0", "12980…
## $ totalInvestmentMillions &lt;chr&gt; "42000.0", "13700.0", "14200.0", "12600.0", "…
## $ windProjectsOnline      &lt;dbl&gt; 136, 45, 107, 104, 35, 49, 98, 31, 25, 20, 28…
## $ numberOfWindTurbines    &lt;chr&gt; "12750.0", "3717.0", "4145.0", "6972.0", "279…
```
]

---
### `select()`: more powerful than you probably thought

--
.leftcol[.code70[
Use `select()` to choose which columns to **keep**

```r
msleep %&gt;%
    select(name:order, sleep_total:sleep_cycle) %&gt;%
    glimpse()
```

```
## Observations: 83
## Variables: 7
## $ name        &lt;chr&gt; "Cheetah", "Owl monkey", "Mountain beaver", "Greater shor…
## $ genus       &lt;chr&gt; "Acinonyx", "Aotus", "Aplodontia", "Blarina", "Bos", "Bra…
## $ vore        &lt;chr&gt; "carni", "omni", "herbi", "omni", "herbi", "herbi", "carn…
## $ order       &lt;chr&gt; "Carnivora", "Primates", "Rodentia", "Soricomorpha", "Art…
## $ sleep_total &lt;dbl&gt; 12.1, 17.0, 14.4, 14.9, 4.0, 14.4, 8.7, 7.0, 10.1, 3.0, 5…
## $ sleep_rem   &lt;dbl&gt; NA, 1.8, 2.4, 2.3, 0.7, 2.2, 1.4, NA, 2.9, NA, 0.6, 0.8, …
## $ sleep_cycle &lt;dbl&gt; NA, NA, NA, 0.1333333, 0.6666667, 0.7666667, 0.3833333, N…
```
]]
--
.rightcol[.code70[
Use `select()` to choose which columns to **drop**

```r
msleep %&gt;%
    select(-(name:order)) %&gt;%
    glimpse()
```

```
## Observations: 83
## Variables: 7
## $ conservation &lt;chr&gt; "lc", NA, "nt", "lc", "domesticated", NA, "vu", NA, "dom…
## $ sleep_total  &lt;dbl&gt; 12.1, 17.0, 14.4, 14.9, 4.0, 14.4, 8.7, 7.0, 10.1, 3.0, …
## $ sleep_rem    &lt;dbl&gt; NA, 1.8, 2.4, 2.3, 0.7, 2.2, 1.4, NA, 2.9, NA, 0.6, 0.8,…
## $ sleep_cycle  &lt;dbl&gt; NA, NA, NA, 0.1333333, 0.6666667, 0.7666667, 0.3833333, …
## $ awake        &lt;dbl&gt; 11.9, 7.0, 9.6, 9.1, 20.0, 9.6, 15.3, 17.0, 13.9, 21.0, …
## $ brainwt      &lt;dbl&gt; NA, 0.01550, NA, 0.00029, 0.42300, NA, NA, NA, 0.07000, …
## $ bodywt       &lt;dbl&gt; 50.000, 0.480, 1.350, 0.019, 600.000, 3.850, 20.490, 0.0…
```
]]

---
## Select columns based on partial column names

--
.leftcol[.code70[
Select columns that start with "sleep":

```r
msleep %&gt;%
    select(name, starts_with("sleep")) %&gt;%
    glimpse()
```

```
## Observations: 83
## Variables: 4
## $ name        &lt;chr&gt; "Cheetah", "Owl monkey", "Mountain beaver", "Greater shor…
## $ sleep_total &lt;dbl&gt; 12.1, 17.0, 14.4, 14.9, 4.0, 14.4, 8.7, 7.0, 10.1, 3.0, 5…
## $ sleep_rem   &lt;dbl&gt; NA, 1.8, 2.4, 2.3, 0.7, 2.2, 1.4, NA, 2.9, NA, 0.6, 0.8, …
## $ sleep_cycle &lt;dbl&gt; NA, NA, NA, 0.1333333, 0.6666667, 0.7666667, 0.3833333, N…
```
]]
--
.rightcol[.code70[
Select columns that contain "eep" and end with "wt":

```r
msleep %&gt;%
    select(contains("eep"), ends_with("wt")) %&gt;%
    glimpse()
```

```
## Observations: 83
## Variables: 5
## $ sleep_total &lt;dbl&gt; 12.1, 17.0, 14.4, 14.9, 4.0, 14.4, 8.7, 7.0, 10.1, 3.0, 5…
## $ sleep_rem   &lt;dbl&gt; NA, 1.8, 2.4, 2.3, 0.7, 2.2, 1.4, NA, 2.9, NA, 0.6, 0.8, …
## $ sleep_cycle &lt;dbl&gt; NA, NA, NA, 0.1333333, 0.6666667, 0.7666667, 0.3833333, N…
## $ brainwt     &lt;dbl&gt; NA, 0.01550, NA, 0.00029, 0.42300, NA, NA, NA, 0.07000, 0…
## $ bodywt      &lt;dbl&gt; 50.000, 0.480, 1.350, 0.019, 600.000, 3.850, 20.490, 0.04…
```
]]

---
## Select columns based on their data type

--
.leftcol60[
Select only numeric columns:

```r
msleep %&gt;%
    select_if(is.numeric) %&gt;%
    glimpse()
```

```
## Observations: 83
## Variables: 6
## $ sleep_total &lt;dbl&gt; 12.1, 17.0, 14.4, 14.9, 4.0, 14.4, 8.7, 7.0, 10.1, 3.0, 5…
## $ sleep_rem   &lt;dbl&gt; NA, 1.8, 2.4, 2.3, 0.7, 2.2, 1.4, NA, 2.9, NA, 0.6, 0.8, …
## $ sleep_cycle &lt;dbl&gt; NA, NA, NA, 0.1333333, 0.6666667, 0.7666667, 0.3833333, N…
## $ awake       &lt;dbl&gt; 11.9, 7.0, 9.6, 9.1, 20.0, 9.6, 15.3, 17.0, 13.9, 21.0, 1…
## $ brainwt     &lt;dbl&gt; NA, 0.01550, NA, 0.00029, 0.42300, NA, NA, NA, 0.07000, 0…
## $ bodywt      &lt;dbl&gt; 50.000, 0.480, 1.350, 0.019, 600.000, 3.850, 20.490, 0.04…
```
]

---
## Use `select()` to reorder variables

--
.leftcol45[.code70[

```r
msleep %&gt;%
    select(everything()) %&gt;%
    glimpse()
```

```
## Observations: 83
## Variables: 11
## $ name         &lt;chr&gt; "Cheetah", "Owl monkey", "Mountain beaver", "Greater sho…
## $ genus        &lt;chr&gt; "Acinonyx", "Aotus", "Aplodontia", "Blarina", "Bos", "Br…
## $ vore         &lt;chr&gt; "carni", "omni", "herbi", "omni", "herbi", "herbi", "car…
## $ order        &lt;chr&gt; "Carnivora", "Primates", "Rodentia", "Soricomorpha", "Ar…
## $ conservation &lt;chr&gt; "lc", NA, "nt", "lc", "domesticated", NA, "vu", NA, "dom…
## $ sleep_total  &lt;dbl&gt; 12.1, 17.0, 14.4, 14.9, 4.0, 14.4, 8.7, 7.0, 10.1, 3.0, …
## $ sleep_rem    &lt;dbl&gt; NA, 1.8, 2.4, 2.3, 0.7, 2.2, 1.4, NA, 2.9, NA, 0.6, 0.8,…
## $ sleep_cycle  &lt;dbl&gt; NA, NA, NA, 0.1333333, 0.6666667, 0.7666667, 0.3833333, …
## $ awake        &lt;dbl&gt; 11.9, 7.0, 9.6, 9.1, 20.0, 9.6, 15.3, 17.0, 13.9, 21.0, …
## $ brainwt      &lt;dbl&gt; NA, 0.01550, NA, 0.00029, 0.42300, NA, NA, NA, 0.07000, …
## $ bodywt       &lt;dbl&gt; 50.000, 0.480, 1.350, 0.019, 600.000, 3.850, 20.490, 0.0…
```
]]
--
.rightcol55[.code70[

```r
msleep %&gt;%
    select(conservation, sleep_total, everything()) %&gt;%
    glimpse()
```

```
## Observations: 83
## Variables: 11
## $ conservation &lt;chr&gt; "lc", NA, "nt", "lc", "domesticated", NA, "vu", NA, "dom…
## $ sleep_total  &lt;dbl&gt; 12.1, 17.0, 14.4, 14.9, 4.0, 14.4, 8.7, 7.0, 10.1, 3.0, …
## $ name         &lt;chr&gt; "Cheetah", "Owl monkey", "Mountain beaver", "Greater sho…
## $ genus        &lt;chr&gt; "Acinonyx", "Aotus", "Aplodontia", "Blarina", "Bos", "Br…
## $ vore         &lt;chr&gt; "carni", "omni", "herbi", "omni", "herbi", "herbi", "car…
## $ order        &lt;chr&gt; "Carnivora", "Primates", "Rodentia", "Soricomorpha", "Ar…
## $ sleep_rem    &lt;dbl&gt; NA, 1.8, 2.4, 2.3, 0.7, 2.2, 1.4, NA, 2.9, NA, 0.6, 0.8,…
## $ sleep_cycle  &lt;dbl&gt; NA, NA, NA, 0.1333333, 0.6666667, 0.7666667, 0.3833333, …
## $ awake        &lt;dbl&gt; 11.9, 7.0, 9.6, 9.1, 20.0, 9.6, 15.3, 17.0, 13.9, 21.0, …
## $ brainwt      &lt;dbl&gt; NA, 0.01550, NA, 0.00029, 0.42300, NA, NA, NA, 0.07000, …
## $ bodywt       &lt;dbl&gt; 50.000, 0.480, 1.350, 0.019, 600.000, 3.850, 20.490, 0.0…
```
]]

---
## Use `select()` to **rename** variables

--
.leftcol[.code70[
Use `rename()` to just change the name

```r
msleep %&gt;%
    rename(animal = name,
           extinction_threat = conservation) %&gt;%
    glimpse()
```

```
## Observations: 83
## Variables: 11
## $ animal            &lt;chr&gt; "Cheetah", "Owl monkey", "Mountain beaver", "Greate…
## $ genus             &lt;chr&gt; "Acinonyx", "Aotus", "Aplodontia", "Blarina", "Bos"…
## $ vore              &lt;chr&gt; "carni", "omni", "herbi", "omni", "herbi", "herbi",…
## $ order             &lt;chr&gt; "Carnivora", "Primates", "Rodentia", "Soricomorpha"…
## $ extinction_threat &lt;chr&gt; "lc", NA, "nt", "lc", "domesticated", NA, "vu", NA,…
## $ sleep_total       &lt;dbl&gt; 12.1, 17.0, 14.4, 14.9, 4.0, 14.4, 8.7, 7.0, 10.1, …
## $ sleep_rem         &lt;dbl&gt; NA, 1.8, 2.4, 2.3, 0.7, 2.2, 1.4, NA, 2.9, NA, 0.6,…
## $ sleep_cycle       &lt;dbl&gt; NA, NA, NA, 0.1333333, 0.6666667, 0.7666667, 0.3833…
## $ awake             &lt;dbl&gt; 11.9, 7.0, 9.6, 9.1, 20.0, 9.6, 15.3, 17.0, 13.9, 2…
## $ brainwt           &lt;dbl&gt; NA, 0.01550, NA, 0.00029, 0.42300, NA, NA, NA, 0.07…
## $ bodywt            &lt;dbl&gt; 50.000, 0.480, 1.350, 0.019, 600.000, 3.850, 20.490…
```
]]
--
.rightcol[.code70[
Use `select()` to change the name **and drop everything else**

```r
msleep %&gt;%
    select(animal = name,
           extinction_threat = conservation) %&gt;%
    glimpse()
```

```
## Observations: 83
## Variables: 2
## $ animal            &lt;chr&gt; "Cheetah", "Owl monkey", "Mountain beaver", "Greate…
## $ extinction_threat &lt;chr&gt; "lc", NA, "nt", "lc", "domesticated", NA, "vu", NA,…
```
]]

---
class: inverse

.leftcol40[
## Your turn

<div class="countdown blink-colon noupdate-15" id="timer_5e567ea3" style="bottom:0;left:8;font-size:2em;" data-warnwhen="30">
<code class="countdown-time"><span class="countdown-digits minutes">15</span><span class="countdown-digits colon">:</span><span class="countdown-digits seconds">00</span></code>
</div>
Read in the `hot_dog_winners.xlsx` file and adjust the variable names and types to the following:

```
## Observations: 42
## Variables: 7
## $ year              &lt;dbl&gt; 1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 198…
## $ competitor.mens   &lt;chr&gt; "Paul Siederman &amp; Joe Baldini", "Thomas DeBerry", "…
## $ competitor.womens &lt;chr&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,…
## $ dogs_eaten.mens   &lt;dbl&gt; 9.10, 11.00, 11.00, 19.50, 9.50, 11.75, 15.50, 12.0…
## $ dogs_eaten.womens &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,…
## $ country.mens      &lt;chr&gt; "United States", "United States", "United States", …
## $ country.womens    &lt;chr&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,…
```

]
.rightcol60[
&lt;center&gt;
&lt;img src="images/hot_dogs.png" width=500&gt;
&lt;/center&gt;
]

---
class: inverse

# 5 minute break!

<div class="countdown" id="timer_5e567bde" style="bottom:0;left:0;font-size:5em;" data-warnwhen="30">
<code class="countdown-time"><span class="countdown-digits minutes">05</span><span class="countdown-digits colon">:</span><span class="countdown-digits seconds">00</span></code>
</div>

## Stand up

## Move around

## Stretch!

---
class: inverse, middle

# Data cleaning &amp; joins

## 1. Joins
## 2. Re-typing variables
## 3. Re-naming variables
## 4. .orange[Re-coding variables]
## 5. Data cleaning strategies



---
# Recoding with `if_else()`

.leftcol40[
Example: Create a variable, `cost_high`, that is `TRUE` if the repair costs were greater than the median costs and `FALSE` otherwise.
]
.rightcol60[.code70[

```r
wildlife_impacts1 &lt;- wildlife_impacts %&gt;%
    rename(cost = cost_repairs_infl_adj) %&gt;%
    dplyr::filter(! is.na(cost)) %&gt;%
*   mutate(cost_high = if_else(cost &gt; median(cost), TRUE, FALSE))

wildlife_impacts1 %&gt;%
    select(cost, cost_high) %&gt;%
    head()
```

```
## # A tibble: 6 x 2
##     cost cost_high
##    &lt;dbl&gt; &lt;lgl&gt;    
## 1   1000 FALSE    
## 2    200 FALSE    
## 3  10000 FALSE    
## 4 100000 TRUE     
## 5  20000 FALSE    
## 6 487000 TRUE
```
]]

---
## Recoding with **nested** `if_else()`

.leftcol40[
Example:

Create a variable, `season`, based on the `incident_month` variable.
]
.rightcol60[.code70[

```r
wildlife_impacts2 &lt;- wildlife_impacts %&gt;%
*   mutate(season = if_else(
*       incident_month %in% c(3, 4, 5), 'spring', if_else(
*       incident_month %in% c(6, 7, 8), 'summer', if_else(
*       incident_month %in% c(9, 10, 11), 'fall', 'winter'))))

wildlife_impacts2 %&gt;%
    distinct(incident_month, season) %&gt;%
    head()
```

```
## # A tibble: 6 x 2
##   incident_month season
##            &lt;dbl&gt; &lt;chr&gt; 
## 1             12 winter
## 2             11 fall  
## 3             10 fall  
## 4              9 fall  
## 5              8 summer
## 6              7 summer
```
]]

---
## Recoding with `case_when()`

.leftcol40[
Example:

Create a variable, `season`, based on the `incident_month` variable.
]
.rightcol60[.code70[

```r
wildlife_impacts2 &lt;- wildlife_impacts %&gt;%
*   mutate(season = case_when(
*       incident_month %in% c(3, 4, 5) ~ 'spring',
*       incident_month %in% c(6, 7, 8) ~ 'summer',
*       incident_month %in% c(9, 10, 11) ~ 'fall',
*       TRUE ~ 'winter'))

wildlife_impacts2 %&gt;%
    distinct(incident_month, season) %&gt;%
    head()
```

```
## # A tibble: 6 x 2
##   incident_month season
##            &lt;dbl&gt; &lt;chr&gt; 
## 1             12 winter
## 2             11 fall  
## 3             10 fall  
## 4              9 fall  
## 5              8 summer
## 6              7 summer
```
]]

---
## Recoding with `case_when()`

.leftcol40[
Example:

Create a variable, `season`, based on the `incident_month` variable.
]
.rightcol60[.code70[

```r
wildlife_impacts2 &lt;- wildlife_impacts %&gt;%
*   mutate(season = case_when(
*       between(incident_month, 3, 5) ~ 'spring',
*       between(incident_month, 6, 8) ~ 'summer',
*       between(incident_month, 9, 11) ~ 'fall',
*       TRUE ~ 'winter'))

wildlife_impacts2 %&gt;%
    distinct(incident_month, season) %&gt;%
    head()
```

```
## # A tibble: 6 x 2
##   incident_month season
##            &lt;dbl&gt; &lt;chr&gt; 
## 1             12 winter
## 2             11 fall  
## 3             10 fall  
## 4              9 fall  
## 5              8 summer
## 6              7 summer
```
]]

---
## `case_when()` is a bit "cleaner" than `if_else()`

Example:

Convert the `num_engs` variable into a string of the number.

--
.leftcol55[.code70[
`if_else()`

```r
wildlife_impacts3 &lt;- wildlife_impacts %&gt;%
    mutate(num_engs = if_else(
        num_engs == 1, 'one', if_else(
        num_engs == 2, 'two', if_else(
        num_engs == 3, 'three', if_else(
        num_engs == 4, 'four', as.character(num_engs))))))

unique(wildlife_impacts3$num_engs)
```

```
## [1] "two"   NA      "three" "four"  "one"
```
]]
--
.rightcol45[.code70[
`case_when()`


```r
wildlife_impacts3 &lt;- wildlife_impacts %&gt;%
    mutate(num_engs = case_when(
        num_engs == 1 ~ 'one',
        num_engs == 2 ~ 'two',
        num_engs == 3 ~ 'three',
        num_engs == 4 ~ 'four'))

unique(wildlife_impacts3$num_engs)
```

```
## [1] "two"   NA      "three" "four"  "one"
```
]]

---
## Break a single variable into two with `separate()`

.leftcol45[

```r
tuberculosis_rates
```

```
## # A tibble: 6 x 3
##   country      year rate             
## * &lt;chr&gt;       &lt;int&gt; &lt;chr&gt;            
## 1 Afghanistan  1999 745/19987071     
## 2 Afghanistan  2000 2666/20595360    
## 3 Brazil       1999 37737/172006362  
## 4 Brazil       2000 80488/174504898  
## 5 China        1999 212258/1272915272
## 6 China        2000 213766/1280428583
```
]
--
.rightcol55[

```r
tuberculosis_rates %&gt;%
* separate(rate, into = c("cases", "population"))
```

```
## # A tibble: 6 x 4
##   country      year cases  population
##   &lt;chr&gt;       &lt;int&gt; &lt;chr&gt;  &lt;chr&gt;     
## 1 Afghanistan  1999 745    19987071  
## 2 Afghanistan  2000 2666   20595360  
## 3 Brazil       1999 37737  172006362 
## 4 Brazil       2000 80488  174504898 
## 5 China        1999 212258 1272915272
## 6 China        2000 213766 1280428583
```
]

---
## Break a single variable into two with `separate()`

.leftcol45[

```r
tuberculosis_rates
```

```
## # A tibble: 6 x 3
##   country      year rate             
## * &lt;chr&gt;       &lt;int&gt; &lt;chr&gt;            
## 1 Afghanistan  1999 745/19987071     
## 2 Afghanistan  2000 2666/20595360    
## 3 Brazil       1999 37737/172006362  
## 4 Brazil       2000 80488/174504898  
## 5 China        1999 212258/1272915272
## 6 China        2000 213766/1280428583
```
]
.rightcol55[

```r
tuberculosis_rates %&gt;%
  separate(rate, into = c("cases", "population"),
*          sep = "/")
```

```
## # A tibble: 6 x 4
##   country      year cases  population
##   &lt;chr&gt;       &lt;int&gt; &lt;chr&gt;  &lt;chr&gt;     
## 1 Afghanistan  1999 745    19987071  
## 2 Afghanistan  2000 2666   20595360  
## 3 Brazil       1999 37737  172006362 
## 4 Brazil       2000 80488  174504898 
## 5 China        1999 212258 1272915272
## 6 China        2000 213766 1280428583
```
]

---
## Break a single variable into two with `separate()`

.leftcol45[

```r
tuberculosis_rates
```

```
## # A tibble: 6 x 3
##   country      year rate             
## * &lt;chr&gt;       &lt;int&gt; &lt;chr&gt;            
## 1 Afghanistan  1999 745/19987071     
## 2 Afghanistan  2000 2666/20595360    
## 3 Brazil       1999 37737/172006362  
## 4 Brazil       2000 80488/174504898  
## 5 China        1999 212258/1272915272
## 6 China        2000 213766/1280428583
```
]
.rightcol55[

```r
tuberculosis_rates %&gt;%
  separate(rate, into = c("cases", "population"),
*          sep = "/", convert = TRUE)
```

```
## # A tibble: 6 x 4
##   country      year  cases population
##   &lt;chr&gt;       &lt;int&gt;  &lt;int&gt;      &lt;int&gt;
## 1 Afghanistan  1999    745   19987071
## 2 Afghanistan  2000   2666   20595360
## 3 Brazil       1999  37737  172006362
## 4 Brazil       2000  80488  174504898
## 5 China        1999 212258 1272915272
## 6 China        2000 213766 1280428583
```
]

---
## You can also break up a variable by an index

.leftcol45[

```r
tuberculosis_rates
```

```
## # A tibble: 6 x 3
##   country      year rate             
## * &lt;chr&gt;       &lt;int&gt; &lt;chr&gt;            
## 1 Afghanistan  1999 745/19987071     
## 2 Afghanistan  2000 2666/20595360    
## 3 Brazil       1999 37737/172006362  
## 4 Brazil       2000 80488/174504898  
## 5 China        1999 212258/1272915272
## 6 China        2000 213766/1280428583
```
]
.rightcol55[

```r
tuberculosis_rates %&gt;%
  separate(year, into = c("century", "year"),
*          sep = 1)
```

```
## # A tibble: 6 x 4
##   country     century year  rate             
##   &lt;chr&gt;       &lt;chr&gt;   &lt;chr&gt; &lt;chr&gt;            
## 1 Afghanistan 1       999   745/19987071     
## 2 Afghanistan 2       000   2666/20595360    
## 3 Brazil      1       999   37737/172006362  
## 4 Brazil      2       000   80488/174504898  
## 5 China       1       999   212258/1272915272
## 6 China       2       000   213766/1280428583
```
]

---
## `unite()`: The opposite of `separate()`

.leftcol45[

```r
tuberculosis_rates
```

```
## # A tibble: 6 x 3
##   country      year rate             
## * &lt;chr&gt;       &lt;int&gt; &lt;chr&gt;            
## 1 Afghanistan  1999 745/19987071     
## 2 Afghanistan  2000 2666/20595360    
## 3 Brazil       1999 37737/172006362  
## 4 Brazil       2000 80488/174504898  
## 5 China        1999 212258/1272915272
## 6 China        2000 213766/1280428583
```
]
.rightcol55[

```r
tuberculosis_rates %&gt;%
  separate(year, into = c("century", "year"),
           sep = 1) %&gt;%
* unite(year_new, century, year)
```

```
## # A tibble: 6 x 3
##   country     year_new rate             
##   &lt;chr&gt;       &lt;chr&gt;    &lt;chr&gt;            
## 1 Afghanistan 1_999    745/19987071     
## 2 Afghanistan 2_000    2666/20595360    
## 3 Brazil      1_999    37737/172006362  
## 4 Brazil      2_000    80488/174504898  
## 5 China       1_999    212258/1272915272
## 6 China       2_000    213766/1280428583
```
]

---
## `unite()`: The opposite of `separate()`

.leftcol45[

```r
tuberculosis_rates
```

```
## # A tibble: 6 x 3
##   country      year rate             
## * &lt;chr&gt;       &lt;int&gt; &lt;chr&gt;            
## 1 Afghanistan  1999 745/19987071     
## 2 Afghanistan  2000 2666/20595360    
## 3 Brazil       1999 37737/172006362  
## 4 Brazil       2000 80488/174504898  
## 5 China        1999 212258/1272915272
## 6 China        2000 213766/1280428583
```
]
.rightcol55[

```r
tuberculosis_rates %&gt;%
  separate(year, into = c("century", "year"),
           sep = 2) %&gt;%
  unite(year_new, century, year,
*       sep = "")
```

```
## # A tibble: 6 x 3
##   country     year_new rate             
##   &lt;chr&gt;       &lt;chr&gt;    &lt;chr&gt;            
## 1 Afghanistan 1999     745/19987071     
## 2 Afghanistan 2000     2666/20595360    
## 3 Brazil      1999     37737/172006362  
## 4 Brazil      2000     80488/174504898  
## 5 China       1999     212258/1272915272
## 6 China       2000     213766/1280428583
```
]

---
class: inverse, middle, center

# Dates

---
class: inverse, middle, center

&lt;center&gt;
&lt;img src="images/dates.png" width=600&gt;
&lt;center&gt;

---
### Create dates from strings - **order is the ONLY thing that matters!**

`library(lubridate)`

--
.cols3[
.center[Year-Month-Day]

```r
ymd('2020-02-26')
```

```
## [1] "2020-02-26"
```

```r
ymd('2020 Feb 26')
```

```
## [1] "2020-02-26"
```

```r
ymd('2020 Feb. 26')
```

```
## [1] "2020-02-26"
```

```r
ymd('2020 february 26')
```

```
## [1] "2020-02-26"
```
]
--
.cols3[
.center[Month-Day-Year]

```r
mdy('February 26, 2020')
```

```
## [1] "2020-02-26"
```

```r
mdy('Feb. 26, 2020')
```

```
## [1] "2020-02-26"
```

```r
mdy('Feb 26 2020')
```

```
## [1] "2020-02-26"
```
]
--
.cols3[
.center[Day-Month-Year]

```r
dmy('26 February 2020')
```

```
## [1] "2020-02-26"
```

```r
dmy('26 Feb. 2020')
```

```
## [1] "2020-02-26"
```

```r
dmy('26 Feb, 2020')
```

```
## [1] "2020-02-26"
```
]

---
## Manipulate dates


```r
date &lt;- today()
date
```

```
## [1] "2020-02-26"
```
--
.leftcol[.code70[

```r
# Get the year
year(date)
```

```
## [1] 2020
```

```r
# Get the month
month(date)
```

```
## [1] 2
```

```r
# Get the month name
month(date, label = TRUE, abbr = FALSE)
```

```
## [1] February
## 12 Levels: January &lt; February &lt; March &lt; April &lt; May &lt; June &lt; ... &lt; December
```
]]
--
.rightcol[.code70[


```r
# Get the day
day(date)
```

```
## [1] 26
```

```r
# Get the weekday
wday(date)
```

```
## [1] 4
```

```r
# Get the weekday name
wday(date, label = TRUE, abbr = TRUE)
```

```
## [1] Wed
## Levels: Sun &lt; Mon &lt; Tue &lt; Wed &lt; Thu &lt; Fri &lt; Sat
```
]]

---
## Modify elements of the date

```r
date &lt;- today()
date
```

```
## [1] "2020-02-26"
```
--

```r
# Change the year
year(date) &lt;- 2016
date
```

```
## [1] "2016-02-26"
```
--

```r
# Change the day
day(date) &lt;- 30
```
--

```r
date
```

```
## [1] "2016-03-01"
```

---
class: inverse

.leftcol[.font80[
### Your turn

1) Use `case_when()` to modify the `phase_of_flt` variable in the `wildlife_impacts` data:

- The values `'approach'`, `'arrival'`, `'descent'`, and `'landing roll'` should be merged into a single value called `'arrival'`.
- The values `'climb'`, `'departure'`,  and `'take-off run'` should be merged into a single value called `'departure'`.
- All other values should be called `'other'`.

Before:
.code70[

```r
unique(str_to_lower(wildlife_impacts$phase_of_flt))
```

```
##  [1] "climb"        "landing roll" NA             "approach"     "take-off run"
##  [6] "departure"    "arrival"      "descent"      "local"        "taxi"        
## [11] "unknown"      "en route"     "parked"
```
After:

```
## [1] "departure" "arrival"   "other"
```
]]]
--
.rightcol[.font80[
<div class="countdown blink-colon noupdate-15" id="timer_5e567d9b" style="right:0;bottom:0;font-size:1.5em;position: relative; width: min-content;&#10;                   display: block; margin-left: 300px;" data-warnwhen="30">
<code class="countdown-time"><span class="countdown-digits minutes">20</span><span class="countdown-digits colon">:</span><span class="countdown-digits seconds">00</span></code>
</div>
2) Use the **lubridate** package to create a new variable, `weekday_name`, from the `incident_date` variable in the `wildlife_impacts` data.

3) Use `weekday_name` and `phase_of_flt` to make this plot of "arrival" and "departure" impacts from **Feb. 2016**.

&lt;img src="slides-7-cleaning-joins_files/figure-html/unnamed-chunk-78-1.png" width="504" style="display: block; margin: auto;" /&gt;
]]


---
class: inverse, middle

# Data cleaning &amp; joins

## 1. Joins
## 2. Re-typing variables
## 3. Re-naming variables
## 4. Re-coding variables
## 5. .orange[Data cleaning strategies]



---
.leftcol40[

## Stragies for when variables encode 2 things

#### 1. Divide &amp; conquer
#### 2. Gather, separate, spread

&lt;br&gt;

Example:

Winners of Nathan's hot dog eating contest
]
.rightcol60[.center[
&lt;center&gt;
&lt;img src="images/hot_dogs.png" width=500&gt;
&lt;/center&gt;
]]

---
## Strategy 1: divide &amp; conquer

.leftcol40[
Steps:

1. Read in the data
2. Clean the names
3. Remove `*` note at bottom of table
]
.rightcol60[

```r
hot_dogs &lt;- read_excel(
    here::here('data', 'hot_dog_winners.xlsx'),
    sheet = 'hot_dog_winners') %&gt;%
    clean_names() %&gt;%
    dplyr::filter(!is.na(mens))

glimpse(hot_dogs)
```

```
## Observations: 40
## Variables: 7
## $ year         &lt;chr&gt; "1980", "1981", "1982", "1983", "1984", "1985", "1986", …
## $ mens         &lt;chr&gt; "Paul Siederman &amp; Joe Baldini", "Thomas DeBerry", "Steve…
## $ dogs_eaten_3 &lt;chr&gt; "9.1", "11", "11", "19.5", "9.5", "11.75", "15.5", "12",…
## $ country_4    &lt;chr&gt; "United States", "United States", "United States", "Mexi…
## $ womens       &lt;chr&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …
## $ dogs_eaten_6 &lt;chr&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …
## $ country_7    &lt;chr&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …
```
]

---
## Strategy 1: divide &amp; conquer

.leftcol40[
Steps

1. Read in the data
2. Clean the names
3. Remove `*` note at bottom of table
4. **Split data into two competitions with the same variable names**
5. **Create new variable in each data frame: `competition`**
]
.rightcol60[

```r
hot_dogs_m &lt;- hot_dogs %&gt;%
    select(
        year,
        competitor = mens,
        dogs_eaten = dogs_eaten_3,
        country    = country_4) %&gt;%
    mutate(competition = 'Mens')

hot_dogs_w &lt;- hot_dogs %&gt;%
    select(
        year,
        competitor = womens,
        dogs_eaten = dogs_eaten_6,
        country    = country_7) %&gt;%
    mutate(competition = 'Womens') %&gt;%
    dplyr::filter(!is.na(competitor))
```
]

---
## Strategy 1: divide &amp; conquer

.leftcol40[
Steps

1. Read in the data
2. Clean the names
3. Remove `*` note at bottom of table
4. Split data into two competitions **with the same variable names**
5. Create new variable in each data frame: `competition`
6. **Merge data together with `bind_rows()`**
7. **Clean up final data frame**
]
.rightcol60[

```r
*hot_dogs &lt;- bind_rows(hot_dogs_m, hot_dogs_w) %&gt;%
    mutate(
        new_record = str_detect(dogs_eaten, "\\*"),
        dogs_eaten = parse_number(dogs_eaten),
        year       = as.numeric(year))

glimpse(hot_dogs)
```

```
## Observations: 49
## Variables: 6
## $ year        &lt;dbl&gt; 1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 198…
## $ competitor  &lt;chr&gt; "Paul Siederman &amp; Joe Baldini", "Thomas DeBerry", "Steven…
## $ dogs_eaten  &lt;dbl&gt; 9.10, 11.00, 11.00, 19.50, 9.50, 11.75, 15.50, 12.00, 14.…
## $ country     &lt;chr&gt; "United States", "United States", "United States", "Mexic…
## $ competition &lt;chr&gt; "Mens", "Mens", "Mens", "Mens", "Mens", "Mens", "Mens", "…
## $ new_record  &lt;lgl&gt; FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, F…
```
]

---
## Strategy 2: gather, separate, spread

.leftcol40[
Steps:

1. Read in the data
2. Clean the names
3. Remove `*` note at bottom of table
]
.rightcol60[

```r
hot_dogs &lt;- read_excel(
    here::here('data', 'hot_dog_winners.xlsx'),
    sheet = 'hot_dog_winners') %&gt;%
    clean_names() %&gt;%
    dplyr::filter(!is.na(mens))

glimpse(hot_dogs)
```

```
## Observations: 40
## Variables: 7
## $ year         &lt;chr&gt; "1980", "1981", "1982", "1983", "1984", "1985", "1986", …
## $ mens         &lt;chr&gt; "Paul Siederman &amp; Joe Baldini", "Thomas DeBerry", "Steve…
## $ dogs_eaten_3 &lt;chr&gt; "9.1", "11", "11", "19.5", "9.5", "11.75", "15.5", "12",…
## $ country_4    &lt;chr&gt; "United States", "United States", "United States", "Mexi…
## $ womens       &lt;chr&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …
## $ dogs_eaten_6 &lt;chr&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …
## $ country_7    &lt;chr&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …
```
]

---
## Strategy 2: gather, separate, spread

.leftcol40[
Steps:

1. Read in the data
2. Clean the names
3. Remove `*` note at bottom of table
4. **Rename variables**
5. **Gather all the "joint" variables**
]
.rightcol60[

```r
hot_dogs &lt;- hot_dogs %&gt;%
    select(
        year,
        competitor.mens   = mens,
        competitor.womens = womens,
        dogs_eaten.mens   = dogs_eaten_3,
        dogs_eaten.womens = dogs_eaten_6,
        country.mens      = country_4,
        country.womens    = country_7) %&gt;%
    gather(key = 'variable', value = 'value',
           competitor.mens:country.womens)

head(hot_dogs, 3)
```

```
## # A tibble: 3 x 3
##   year  variable        value                       
##   &lt;chr&gt; &lt;chr&gt;           &lt;chr&gt;                       
## 1 1980  competitor.mens Paul Siederman &amp; Joe Baldini
## 2 1981  competitor.mens Thomas DeBerry              
## 3 1982  competitor.mens Steven Abrams
```
]

---
## Strategy 2: gather, separate, spread

.leftcol30[
Steps:

1. Read in the data
2. Clean the names
3. Remove `*` note at bottom of table
4. Rename variables
5. Gather all the "joint" variables
6. **Separate "joint" variables into components**
]
.rightcol70[

```r
hot_dogs &lt;- hot_dogs %&gt;%
    separate(variable, into = c('variable', 'competition'),
             sep = '\\.')

head(hot_dogs)
```

```
## # A tibble: 6 x 4
##   year  variable   competition value                       
##   &lt;chr&gt; &lt;chr&gt;      &lt;chr&gt;       &lt;chr&gt;                       
## 1 1980  competitor mens        Paul Siederman &amp; Joe Baldini
## 2 1981  competitor mens        Thomas DeBerry              
## 3 1982  competitor mens        Steven Abrams               
## 4 1983  competitor mens        Luis Llamas                 
## 5 1984  competitor mens        Birgit Felden               
## 6 1985  competitor mens        Oscar Rodriguez
```
]

---
## Strategy 2: gather, separate, spread

.leftcol30[
Steps:

1. Read in the data
2. Clean the names
3. Remove `*` note at bottom of table
4. Rename variables
5. Gather all the "joint" variables
6. Separate "joint" variables into components
7. **Spread variable and value back to columns**
8. **Clean up final data frame**
]
.rightcol70[

```r
hot_dogs &lt;- hot_dogs %&gt;%
*   spread(key = variable, value = value) %&gt;%
    mutate(
        new_record = str_detect(dogs_eaten, "\\*"),
        dogs_eaten = parse_number(dogs_eaten),
        year       = as.numeric(year))

glimpse(hot_dogs)
```

```
## Observations: 80
## Variables: 6
## $ year        &lt;dbl&gt; 1980, 1980, 1981, 1981, 1982, 1982, 1983, 1983, 1984, 198…
## $ competition &lt;chr&gt; "mens", "womens", "mens", "womens", "mens", "womens", "me…
## $ competitor  &lt;chr&gt; "Paul Siederman &amp; Joe Baldini", NA, "Thomas DeBerry", NA,…
## $ country     &lt;chr&gt; "United States", NA, "United States", NA, "United States"…
## $ dogs_eaten  &lt;dbl&gt; 9.10, NA, 11.00, NA, 11.00, NA, 19.50, NA, 9.50, NA, 11.7…
## $ new_record  &lt;lgl&gt; FALSE, NA, FALSE, NA, FALSE, NA, FALSE, NA, FALSE, NA, FA…
```
]

---
.leftcol[.code60[
Divide &amp; conquer

```r
hot_dogs &lt;- read_excel(
    here::here('data', 'hot_dog_winners.xlsx'),
    sheet = 'hot_dog_winners') %&gt;%
    clean_names() %&gt;%
    dplyr::filter(!is.na(mens))

*# Divide
*hot_dogs_m &lt;- hot_dogs %&gt;%
*   select(
*       year,
*       competitor = mens,
*       dogs_eaten = dogs_eaten_3,
*       country    = country_4) %&gt;%
*   mutate(competition = 'Mens')

*hot_dogs_w &lt;- hot_dogs %&gt;%
*   select(
*       year,
*       competitor = womens,
*       dogs_eaten = dogs_eaten_6,
*       country    = country_7) %&gt;%
*   mutate(competition = 'Womens') %&gt;%
*   dplyr::filter(!is.na(competitor))

# Merge and finish cleaning
*hot_dogs &lt;- bind_rows(hot_dogs_m, hot_dogs_w) %&gt;%
    mutate(
        new_record = str_detect(dogs_eaten, "\\*"),
        dogs_eaten = parse_number(dogs_eaten),
        year       = as.numeric(year))
```
]]
.rightcol[.code60[
Gather, separate, spread

```r
hot_dogs &lt;- read_excel(
    here::here('data', 'hot_dog_winners.xlsx'),
    sheet = 'hot_dog_winners') %&gt;%
    clean_names() %&gt;%
    dplyr::filter(!is.na(mens)) %&gt;%
*   # Rename variables
*   select(
*       year,
*       competitor.mens   = mens,
*       competitor.womens = womens,
*       dogs_eaten.mens   = dogs_eaten_3,
*       dogs_eaten.womens = dogs_eaten_6,
*       country.mens      = country_4,
*       country.womens    = country_7) %&gt;%
*   # Gather "joint" variables
*   gather(key = 'variable', value = 'value',
*          competitor.mens:country.womens) %&gt;%
*   # Separate "joint" variables
*   separate(variable, into = c('variable', 'competition'),
*            sep = '\\.') %&gt;%
*   # Spread "joint" variables
*   spread(key = variable, value = value) %&gt;%
    # Finish cleaning
    mutate(
        new_record = str_detect(dogs_eaten, "\\*"),
        dogs_eaten = parse_number(dogs_eaten),
        year       = as.numeric(year))
```
]]

---
.leftcol30[
## Strategies for dealing with sub-headers

&lt;br&gt;

Example:

OICA passenger car sales data
]
.rightcol70[.center[
&lt;br&gt;
&lt;center&gt;
&lt;img src="images/pc_sales.png" width=800&gt;
&lt;/center&gt;
]]

---
## Strategies for dealing with sub-headers

.leftcol40[
Steps:

1. Read in the data, skipping first 5 rows
2. Clean the names
]
.rightcol60[

```r
pc_sales &lt;- read_excel(
    here::here('data', 'pc_sales_2018.xlsx'),
    sheet = 'pc_sales', skip = 5) %&gt;%
    clean_names() %&gt;%
    rename(country = regions_countries)

glimpse(pc_sales)
```

```
## Observations: 160
## Variables: 18
## $ country &lt;chr&gt; NA, "EUROPE", "EU 28 countries + EFTA", "EU 15 countries + EF…
## $ x2      &lt;lgl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, N…
## $ x3      &lt;lgl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, N…
## $ x4      &lt;lgl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, N…
## $ x2005   &lt;dbl&gt; NA, 17906455, 15622035, 14565695, 307915, 480088, 148819, 148…
## $ x2006   &lt;dbl&gt; NA, 18685556, 15961138, 14820182, 308594, 526141, 156936, 145…
## $ x2007   &lt;dbl&gt; NA, 19618588, 16147274, 14842186, 298182, 524795, 162686, 125…
## $ x2008   &lt;dbl&gt; NA, 18821599, 14911880, 13602038, 293697, 535947, 150199, 139…
## $ x2009   &lt;dbl&gt; NA, 16608761, 14533115, 13668808, 319403, 476194, 112454, 905…
## $ x2010   &lt;dbl&gt; NA, 16499863, 13830694, 12984549, 328563, 547340, 153858, 111…
## $ x2011   &lt;dbl&gt; NA, 17167600, 13642659, 12815435, 356145, 572211, 170036, 126…
## $ x2012   &lt;dbl&gt; NA, 16191269, 12567903, 11773281, 336010, 486737, 170763, 111…
## $ x2013   &lt;dbl&gt; NA, 15942273, 12344415, 11555153, 319035, 486065, 182086, 103…
## $ x2014   &lt;dbl&gt; NA, 16154279, 13061461, 12148648, 303318, 482939, 189055, 106…
## $ x2015   &lt;dbl&gt; NA, 16410563, 14287881, 13261258, 308555, 501066, 207717, 108…
## $ x2016   &lt;dbl&gt; NA, 17291819, 15160239, 13971468, 329604, 539519, 222924, 118…
## $ x2017   &lt;dbl&gt; NA, 17974281, 15631283, 14320223, 353320, 546558, 221821, 120…
## $ x2018   &lt;dbl&gt; NA, 17912336, 15626509, 14210016, 341068, 549632, 218566, 120…
```
]

---
## Strategies for dealing with sub-headers

.leftcol30[
Steps:

1. Read in the data, skipping first 5 rows
2. Clean the names
3. **Filter out bad columns**
4. **Filter out bad rows**

&lt;br&gt;

Use **datapasta** to get rows to drop
]
.rightcol70[

```r
drop &lt;- c(
    'EUROPE', 'EU 28 countries + EFTA',
    'EU 15 countries + EFTA', 'EUROPE NEW MEMBERS',
    'RUSSIA, TURKEY &amp; OTHER EUROPE', 'AMERICA',
    'NAFTA', 'CENTRAL &amp; SOUTH AMERICA',
    'ASIA/OCEANIA/MIDDLE EAST', 'AFRICA', 'ALL COUNTRIES')

pc_sales &lt;- pc_sales %&gt;%
    select(-c(x2:x4)) %&gt;%       # Drop bad columns
    filter(! country %in% drop, # Drop bad rows
           ! is.na(country))

head(pc_sales)
```

```
## # A tibble: 6 x 15
##   country   x2005   x2006   x2007   x2008   x2009   x2010   x2011   x2012
##   &lt;chr&gt;     &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;
## 1 AUSTRIA  307915  308594  298182  293697  319403  328563  356145  336010
## 2 BELGIUM  480088  526141  524795  535947  476194  547340  572211  486737
## 3 DENMARK  148819  156936  162686  150199  112454  153858  170036  170763
## 4 FINLAND  148161  145700  125608  139669   90574  111968  126123  111251
## 5 FRANCE  2118042 2045745 2109672 2091369 2302398 2251669 2204229 1898760
## 6 GERMANY 3319259 3467961 3148163 3090040 3807175 2916259 3173634 3082504
##     x2013   x2014   x2015   x2016   x2017   x2018
##     &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;
## 1  319035  303318  308555  329604  353320  341068
## 2  486065  482939  501066  539519  546558  549632
## 3  182086  189055  207717  222924  221821  218566
## 4  103455  106237  108819  118991  120480  120480
## 5 1790456 1795885 1917226 2015177 2110748 2173481
## 6 2952431 3036773 3206042 3351607 3441262 3435778
```
]

---
## Strategies for dealing with sub-headers

.leftcol30[
Steps:

1. Read in the data, skipping first 5 rows
2. Clean the names
3. Filter out bad columns
4. Filter out bad rows
5. **Gather the year variables**
]
.rightcol70[

```r
pc_sales &lt;- pc_sales %&gt;%
    gather(key = 'year', value = 'num_cars', x2005:x2018)

head(pc_sales)
```

```
## # A tibble: 6 x 3
##   country year  num_cars
##   &lt;chr&gt;   &lt;chr&gt;    &lt;dbl&gt;
## 1 AUSTRIA x2005   307915
## 2 BELGIUM x2005   480088
## 3 DENMARK x2005   148819
## 4 FINLAND x2005   148161
## 5 FRANCE  x2005  2118042
## 6 GERMANY x2005  3319259
```
]

---
## Strategies for dealing with sub-headers

.leftcol30[
Steps:

1. Read in the data, skipping first 5 rows
2. Clean the names
3. Filter out bad columns
4. Filter out bad rows
5. Gather the year variables
6. **Separate the "x" from the year**
]
.rightcol70[

```r
pc_sales &lt;- pc_sales %&gt;%
    separate(year, into = c('drop', 'year'), sep = 'x',
             convert = TRUE)

head(pc_sales)
```

```
## # A tibble: 6 x 4
##   country drop   year num_cars
##   &lt;chr&gt;   &lt;lgl&gt; &lt;int&gt;    &lt;dbl&gt;
## 1 AUSTRIA NA     2005   307915
## 2 BELGIUM NA     2005   480088
## 3 DENMARK NA     2005   148819
## 4 FINLAND NA     2005   148161
## 5 FRANCE  NA     2005  2118042
## 6 GERMANY NA     2005  3319259
```
]

---
## Strategies for dealing with sub-headers

.leftcol30[
Steps:

1. Read in the data, skipping first 5 rows
2. Clean the names
3. Filter out bad columns
4. Filter out bad rows
5. Gather the year variables
6. Separate the "x" from the year
7. **Finish cleaning**

]
.rightcol70[

```r
pc_sales &lt;- pc_sales %&gt;%
    select(-drop) %&gt;%
    mutate(
        country  = str_to_title(country),
        num_cars = num_cars / 10^6)

head(pc_sales)
```

```
## # A tibble: 6 x 3
##   country  year num_cars
##   &lt;chr&gt;   &lt;int&gt;    &lt;dbl&gt;
## 1 Austria  2005    0.308
## 2 Belgium  2005    0.480
## 3 Denmark  2005    0.149
## 4 Finland  2005    0.148
## 5 France   2005    2.12 
## 6 Germany  2005    3.32
```
]

---
class: inverse

# Your turn: `weather` case study

Follow along as we:

1. Import the data
2. Gather columns that are values
3. Spread values that are variable names
4. Clean up dates
5. Re-arrange the column order
6. Convert strings to numbers
7. Re-name columns
8. Deal with missing values
9. Fix errors in the data

---
class: inverse



.leftcol[
## Extra practice:&lt;br&gt;`pv_cells` case study

Read in the `pv_cell_production.xlsx` file and format it to produce this data frame.

```r
pv_cells %&gt;% 
    distinct(country)
```

```
## # A tibble: 8 x 1
##   country      
##   &lt;chr&gt;        
## 1 China        
## 2 Taiwan       
## 3 Japan        
## 4 Malaysia     
## 5 Germany      
## 6 South Korea  
## 7 United States
## 8 Others
```
]
.rightcol[

```r
head(pv_cells)
```

```
## # A tibble: 6 x 3
##    year country     n
##   &lt;dbl&gt; &lt;chr&gt;   &lt;dbl&gt;
## 1  1995 China    NA  
## 2  1996 China    NA  
## 3  1997 China    NA  
## 4  1998 China    NA  
## 5  1999 China    NA  
## 6  2000 China     2.5
```

```r
tail(pv_cells)
```

```
## # A tibble: 6 x 3
##    year country     n
##   &lt;dbl&gt; &lt;chr&gt;   &lt;dbl&gt;
## 1  2008 Others   709.
## 2  2009 Others   664.
## 3  2010 Others  1443.
## 4  2011 Others  1834.
## 5  2012 Others  1475.
## 6  2013 Others  1453.
```
]



---
class: inverse, middle

## If you haven't already, now would be a good time to start working on your projects

&lt;br&gt;

## **You have 2 weeks until proposals are due**

---
# Writing a research question

Following [these guidelines](https://writingcenter.gmu.edu/guides/how-to-write-a-research-question), your question should be:

- **Clear**: your audience can easily understand its purpose without additional explanation.
- **Focused**: it is narrow enough that it can be addressed thoroughly with the data available and within the limits of the final project report.
- **Concise**: it is expressed in the fewest possible words.
- **Complex**: it is not answerable with a simple "yes" or "no," but rather requires synthesis and analysis of data.
- **Arguable**: its potential answers are open to debate rather than accepted facts (do others care about it?)

---
class: inverse, middle, center

# This is an iterative process

&lt;center&gt;
&lt;img src="images/rq_iteration.png" width=500&gt;
&lt;/center&gt;
    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script src="https://platform.twitter.com/widgets.js"></script>
<script>var slideshow = remark.create({
"highlightStyle": "github",
"highlightLines": true,
"countIncrementalSlides": false,
"ratio": "16:9"
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();
// adds .remark-code-has-line-highlighted class to <pre> parent elements
// of code chunks containing highlighted lines with class .remark-code-line-highlighted
(function(d) {
  const hlines = d.querySelectorAll('.remark-code-line-highlighted');
  const preParents = [];
  const findPreParent = function(line, p = 0) {
    if (p > 1) return null; // traverse up no further than grandparent
    const el = line.parentElement;
    return el.tagName === "PRE" ? el : findPreParent(el, ++p);
  };

  for (let line of hlines) {
    let pre = findPreParent(line);
    if (pre && !preParents.includes(pre)) preParents.push(pre);
  }
  preParents.forEach(p => p.classList.add("remark-code-has-line-highlighted"));
})(document);</script>

<script>
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
